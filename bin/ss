#!/usr/bin/env bash
# Study Session manager
# Usage: sd
##########################################################
#TODO:
# - Force Subject Number to be within Array
##########################################################


workingDir=""


####### HELPER FUNCTIONS ########
#

createAssignment(){

        title=$1
        cd $workingDir 
        lxf $title
        cd ./$title

        # CREATE ASSIGNMENT SOURCE FILE 

        mkdir source
        cd source

            echo "
        \documentclass{report}

        \input{~/.config/latex_template/preamble.tex}
        \input{~/.config/latex_template/macros.tex}
        \input{~/.config/latex_template/letterfonts.tex}

        \title{\Huge{{INSERT CLASS NAME}}}
        \author{\huge{Luka Flores}}
        \date{}

        \begin{document}

        \maketitle
        \newpage% or \cleardoublepage
        % \pdfbookmark[<level>]{<title>}{<dest>}
        \pdfbookmark[section]{\contentsname}{toc}
        \tableofcontents
        \pagebreak


        \end{document}
        " >> $title-source.tex

        # Create Notes ASSIGNMENT FILE
        nvim  $workingDir/$title/$title.tex +split +terminal
}



showDirectory(){

    workingDir=~/notes/edu/$1
    arrDir=($(ls -1 $workingDir))
    DIRINDEX=$2
    echostring=" SUBJECTS: "

    if ! [[ -z ${DIRINDEX} ]]; then 
        workingDir=~/notes/edu/$1/${arrDir[DIRINDEX]} 
        echostring=" ASSIGNMENTS OF ${arrDir[DIRINDEX]}: "
        arrDir=($(ls -1 $workingDir))
    fi
    
    echo "$echostring"
    for index in ${!arrDir[@]}; do
        echo "      $index: ${arrDir[$index]}"
    done

}

showSubject(){
    SUBJECTINDEX=$1
    if [[ -z ${SUBJECTINDEX} ]]; then
        showDirectory agnDir
    else
        ## If Subject Index is Number 
        re='^[0-9][0-9]*$'
        while ! [[ $SUBJECTINDEX =~ $re ]]; do
            echo "Error: $SUBJECTINDEX ~~ Please Select a Number" 
            read SUBJECTINDEX 
        done
        showDirectory agnDir SUBJECTINDEX 
    fi
}

newAssignment(){
    echo "Add New Assignment"
    showSubject
    echo " " 
    echo "Select a Subject Index:" 
    read subjectIndex 
    showSubject "$subjectIndex"
    echo " " 
    echo "Select Title of Assignment:" 
    read assignmentTitle 
    createAssignment $assignmentTitle 

}

######## START OF SCRIPT ######## 



echo "============================================================================"
echo " " 
echo "      n: Add New Assignment"
echo " " 
echo "============================================================================"
echo " " 

showSubject

echo " "
echo "============================================================================"
echo " "
echo "Enter Character Associated with Command: "

completed=0
while [[ $completed == 0 ]]; do 

    read number
    
    if [[ $number == "n" ]]; then
        clear
        newAssignment
        completed=1
        break
    fi

    re='^[0-9][0-9]*$'
    if [[ $number =~ $re ]]; then
        clear
        showSubject "$number"
        completed=1
        break
    fi

    if [[ completed == 0 ]]; then 
        echo "This index is not in the list, try again:"
    fi 
done

